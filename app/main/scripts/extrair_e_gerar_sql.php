<?php
/**
 * Script para extrair descrições do texto fornecido e gerar SQL completo
 */

// Texto completo fornecido pelo usuário (primeira parte da mensagem)
$textoCompleto = "Ensino Fundamental – Anos Iniciais EF15LP01 - Identificar a função social de textos que circulam em campos da vida social dos quais participa cotidianamente (a casa, a rua, a comunidade, a escola) e nas mídias impressa, de massa e digital, reconhecendo para que foram produzidos, onde circulam, quem os produziu e a quem se destinam., EF15LP02 - Estabelecer expectativas em relação ao texto que vai ler (pressuposições antecipadoras dos sentidos, da forma e da função social do texto), apoiando-se em seus conhecimentos prévios sobre as condições de produção e recepção desse texto, o gênero, o suporte e o universo temático, bem como sobre saliências textuais, recursos gráficos, imagens, dados da própria obra (índice, prefácio etc.), confirmando antecipações e inferências realizadas antes e durante a leitura de textos, checando a adequação das hipóteses realizadas., EF15LP03 - Localizar informações explícitas em textos., EF15LP04 - Identificar o efeito de sentido produzido pelo uso de recursos expressivos  gráfico-visuais em textos multissemióticos., EF15LP05 - Planejar, com a ajuda do professor, o texto que será produzido, considerando a situação comunicativa, os interlocutores (quem escreve/para quem escreve); a finalidade ou o propósito (escrever para quê); a circulação (onde o texto vai circular); o suporte (qual é o portador do texto); a linguagem, organização e forma do texto e seu tema, pesquisando em meios impressos ou digitais, sempre que for preciso, informações necessárias à produção do texto, organizando em tópicos os dados e as fontes pesquisadas., EF15LP06 - Reler e revisar o texto produzido com a ajuda do professor e a colaboração dos colegas, para corrigi-lo e aprimorá-lo, fazendo cortes, acréscimos, reformulações, correções de ortografia e pontuação., EF15LP07 - Editar a versão final do texto, em colaboração com os colegas e com a ajuda do professor, ilustrando, quando for o caso, em suporte adequado, manual ou digital., EF15LP08 - Utilizar software, inclusive programas de edição de texto, para editar e publicar os* textos produzidos, explorando os recursos multissemióticos disponíveis., EF15LP09 - Expressar-se em situações de intercâmbio oral com clareza, preocupando-se em ser compreendido pelo interlocutor e usando a palavra com tom de voz audível, boa articulação e ritmo adequado., EF15LP10 - Escutar, com atenção, falas de professores e colegas, formulando perguntas pertinentes ao tema e solicitando esclarecimentos sempre que necessário., EF15LP11 - Reconhecer características da conversação espontânea presencial, respeitando os turnos de fala, selecionando e utilizando, durante a conversação, formas de tratamento adequadas, de acordo com a situação e a posição do interlocutor., EF15LP12 - Atribuir significado a aspectos não linguísticos (paralinguísticos) observados na fala, como direção do olhar, riso, gestos, movimentos da cabeça (de concordância ou discordância), expressão corporal, tom de voz., EF15LP13 - Identificar finalidades da interação oral em diferentes contextos comunicativos (solicitar informações, apresentar opiniões, informar, relatar experiências etc.)., EF15LP14 - Construir o sentido de histórias em quadrinhos e tirinhas, relacionando imagens e palavras e interpretando recursos gráficos (tipos de balões, de letras, onomatopeias)., EF15LP15 - Reconhecer que os textos literários fazem parte do mundo do imaginário e apresentam uma dimensão lúdica, de encantamento, valorizando-os, em sua diversidade cultural, como patrimônio artístico da humanidade., EF15LP16 - Ler e compreender, em colaboração com os colegas e com a ajuda do professor e, mais tarde, de maneira autônoma, textos narrativos de maior porte como contos (populares, de fadas, acumulativos, de assombração etc.) e crônicas., EF15LP17 - Apreciar poemas visuais e concretos, observando efeitos de sentido criados pelo formato do texto na página, distribuição e diagramação das letras, pelas ilustrações e por outros efeitos visuais., EF15LP18 - Relacionar texto com ilustrações e outros recursos gráficos., EF15LP19 - Recontar oralmente, com e sem apoio de imagem, textos literários lidos pelo professor., EF01LP01 - Reconhecer que textos são lidos e escritos da esquerda para a direita e de cima para baixo da página. EF12LP01 - Ler palavras novas com precisão na decodificação, no caso de palavras de uso frequente, ler globalmente, por memorização., EF12LP02 - Buscar, selecionar e ler, com a mediação do professor (leitura compartilhada), textos que circulam em meios impressos ou digitais, de acordo com as necessidades e interesses., EF01LP02 - Escrever, espontaneamente ou por ditado, palavras e frases de forma alfabética – usando letras/grafemas que representem fonemas. EF01LP03 - Observar escritas convencionais, comparando-as às suas produções escritas, percebendo semelhanças e diferenças. EF02LP01 - Utilizar, ao produzir o texto, grafia correta de palavras conhecidas ou com estruturas silábicas já dominadas, letras maiúsculas em início de frases e em substantivos próprios, segmentação entre as palavras, ponto final, ponto de interrogação e ponto de exclamação., EF12LP03 - Copiar textos breves, mantendo suas características e voltando para o texto sempre que tiver dúvidas sobre sua distribuição gráfica, espaçamento entre as palavras, escrita das palavras e pontuação., EF01LP04 - Distinguir as letras do alfabeto de outros sinais gráficos. EF01LP05 - Reconhecer o sistema de escrita alfabética como representação dos sons da fala. EF01LP06 - Segmentar oralmente palavras em sílabas. EF02LP02 - Segmentar palavras em sílabas e remover e substituir sílabas iniciais, mediais ou finais para criar novas palavras., EF01LP07 - Identificar fonemas e sua representação por letras. EF02LP03 - Ler e escrever palavras com correspondências regulares diretas entre letras e fonemas (f, v, t, d, p, b) e correspondências regulares contextuais (c e q; e e o, em posição átona em final de palavra)., EF01LP08 - Relacionar elementos sonoros (sílabas, fonemas, partes de palavras) com sua representação escrita., EF02LP04 - Ler e escrever corretamente palavras com sílabas CV, V, CVC, CCV, identificando que existem vogais em todas as sílabas., EF01LP09 - Comparar palavras, identificando semelhanças e diferenças entre sons de sílabas iniciais., EF02LP05 - Ler e escrever corretamente palavras com marcas de nasalidade (til, m, n)., EF01LP10 - Nomear as letras do alfabeto e recitá-lo na ordem das letras. EF02LP06 - Perceber o princípio acrofônico que opera nos nomes das letras do alfabeto. EF01LP11 - Conhecer, diferenciar e relacionar letras em formato imprensa e cursiva, maiúsculas e minúsculas. EF02LP07 - Escrever palavras, frases, textos curtos nas formas imprensa e cursiva., EF01LP12 - Reconhecer a separação das palavras, na escrita, por espaços em branco. EF02LP08 - Segmentar corretamente as palavras ao escrever frases e textos., EF01LP13 - Comparar palavras, identificando semelhanças e diferenças entre sons de sílabas mediais e finais. EF01LP14 - Identificar outros sinais no texto além das letras, como pontos finais, de interrogação e exclamação e seus efeitos na entonação. EF02LP09 - Usar adequadamente ponto final, ponto de interrogação e ponto de exclamação., EF01LP15 - Agrupar palavras pelo critério de aproximação de significado (sinonímia) e separar palavras pelo critério de oposição de significado (antonímia). EF02LP10 - Identificar sinônimos de palavras de texto lido, determinando a diferença de sentido entre eles, e formar antônimos de palavras encontradas em texto lido pelo acréscimo do prefixo de negação in-/im-., EF02LP11 - Formar o aumentativo e o diminutivo de palavras com os sufixos -ão e -inho/-zinho., EF12LP04 - Ler e compreender, em colaboração com os colegas e com a ajuda do professor ou já com certa autonomia, listas, agendas, calendários, avisos, convites, receitas, instruções de montagem (digitais ou impressos), dentre outros gêneros do campo da vida cotidiana, considerando a situação comunicativa e o tema/assunto do texto e relacionando sua forma de organização à sua finalidade., EF01LP16 - Ler e compreender, em colaboração com os colegas e com a ajuda do professor, quadras, quadrinhas, parlendas, trava-línguas, dentre outros gêneros do campo da vida cotidiana, considerando a situação comunicativa e o tema/assunto do texto e relacionando sua forma de organização à sua finalidade., EF02LP12 - Ler e compreender com certa autonomia cantigas, letras de canção, dentre outros gêneros do campo da vida cotidiana, considerando a situação comunicativa e o tema/assunto do texto e relacionando sua forma de organização à sua finalidade., EF01LP17 - Planejar e produzir, em colaboração com os colegas e com a ajuda do professor, listas, agendas, calendários, avisos, convites, receitas, instruções de montagem e legendas para álbuns, fotos ou ilustrações (digitais ou impressos), dentre outros gêneros do campo da vida cotidiana, considerando a situação comunicativa e o tema/assunto/ finalidade do texto., EF02LP13 - Planejar e produzir bilhetes e cartas, em meio impresso e/ou digital, dentre outros gêneros do campo da vida cotidiana, considerando a situação comunicativa e o tema/assunto/finalidade do texto., EF01LP18 - Registrar, em colaboração com os colegas e com a ajuda do professor, cantigas, quadras, quadrinhas, parlendas, trava-línguas, dentre outros gêneros do campo da vida cotidiana, considerando a situação comunicativa e o tema/assunto/finalidade do texto., EF02LP14 - Planejar e produzir pequenos relatos de observação de processos, de fatos, de experiências pessoais, mantendo as características do gênero, considerando a situação comunicativa e o tema/assunto do texto., EF12LP05 - Planejar e produzir, em colaboração com os colegas e com a ajuda do professor, (re)contagens de histórias, poemas e outros textos versificados (letras de canção, quadrinhas, cordel), poemas visuais, tiras e histórias em quadrinhos, dentre outros gêneros do campo artístico-literário, considerando a situação comunicativa e a finalidade do texto., EF12LP06 - Planejar e produzir, em colaboração com os colegas e com a ajuda do professor, recados, avisos, convites, receitas, instruções de montagem, dentre outros gêneros do campo da vida cotidiana, que possam ser repassados oralmente por meio de ferramentas digitais, em áudio ou vídeo, considerando a situação comunicativa e o tema/assunto/finalidade do texto., EF01LP19 - Recitar parlendas, quadras, quadrinhas, trava-línguas, com entonação adequada e observando as rimas. EF02LP15 - Cantar cantigas e canções, obedecendo ao ritmo e à melodia., EF12LP07 - Identificar e (re)produzir, em cantiga, quadras, quadrinhas, parlendas, trava-línguas e canções, rimas, aliterações, assonâncias, o ritmo de fala relacionado ao ritmo e à melodia das músicas e seus efeitos de sentido., EF01LP20 - Identificar e reproduzir, em listas, agendas, calendários, regras, avisos, convites, receitas, instruções de montagem e legendas para álbuns, fotos ou ilustrações (digitais ou impressos), a formatação e diagramação específica de cada um desses gêneros., EF02LP16 - Identificar e reproduzir, em  bilhetes, recados, avisos, cartas, e-mails, receitas (modo de fazer), relatos (digitais ou impressos), a formatação e diagramação específica de cada um desses gêneros., EF02LP17 - Identificar e reproduzir, em relatos de experiências pessoais, a sequência dos fatos, utilizando expressões que marquem a passagem do tempo (\"antes\", \"depois\", \"ontem\", \"hoje\", \"amanhã\", \"outro dia\", \"antigamente\", \"há muito tempo\" etc.), e o nível de informatividade necessário., EF12LP08 - Ler e compreender, em colaboração com os colegas e com a ajuda do professor, fotolegendas em notícias, manchetes e lides em notícias, álbum de fotos digital noticioso e notícias curtas para público infantil, dentre outros gêneros do campo jornalístico, considerando a situação comunicativa e o tema/assunto do texto., EF12LP09 - Ler e compreender, em colaboração com os colegas e com a ajuda do professor,  slogans, anúncios publicitários e textos de campanhas de conscientização destinados ao público infantil, dentre outros gêneros do campo publicitário, considerando a situação comunicativa e o tema/assunto do texto., EF12LP10 - Ler e compreender, em colaboração com os colegas e com a ajuda do professor, cartazes, avisos, folhetos, regras e regulamentos que organizam a vida na comunidade escolar, dentre outros gêneros do campo da atuação cidadã, considerando a situação comunicativa e o tema/assunto do texto., EF12LP11 - Escrever, em colaboração com os colegas e com a ajuda do professor, fotolegendas em notícias, manchetes e lides em notícias, álbum de fotos digital noticioso e notícias curtas para público infantil, digitais ou impressos, dentre outros gêneros do campo jornalístico, considerando a situação comunicativa e o tema/assunto do texto., EF12LP12 - Escrever, em colaboração com os colegas e com a ajuda do professor, slogans,* anúncios publicitários e textos de campanhas de conscientização destinados ao público* infantil, dentre outros gêneros do campo publicitário, considerando a situação comunicativa e o tema/ assunto/finalidade do texto., EF01LP21 - Escrever, em colaboração com os colegas e com a ajuda do professor, listas de regras e regulamentos que organizam a vida na comunidade escolar, dentre outros gêneros do campo da atuação cidadã, considerando a situação comunicativa e o tema/assunto do texto., EF02LP18 - Planejar e produzir cartazes e folhetos para divulgar eventos da escola ou da comunidade, utilizando linguagem persuasiva e elementos textuais e visuais (tamanho da letra, leiaute, imagens) adequados ao gênero, considerando a situação comunicativa e o tema/assunto do texto., EF02LP19 - Planejar e produzir, em colaboração com os colegas e com a ajuda do professor, notícias curtas para público infantil,  para compor jornal falado que possa ser repassado oralmente ou em meio digital, em áudio ou vídeo, dentre outros gêneros do campo jornalístico, considerando a situação comunicativa e o tema/assunto do texto., EF12LP13 - Planejar, em colaboração com os colegas e com a ajuda do professor, slogans e* peça de campanha de conscientização destinada ao público infantil que possam ser repassados* oralmente por meio de ferramentas digitais, em áudio ou vídeo, considerando a situação comunicativa e o tema/assunto/finalidade do texto., EF12LP14 - Identificar e reproduzir, em fotolegendas de notícias, álbum de fotos digital noticioso, cartas de leitor (revista infantil), digitais ou impressos, a formatação e diagramação específica de cada um desses gêneros, inclusive em suas versões orais., EF12LP15 - Identificar a forma de composição de slogans publicitários., EF12LP16 - Identificar e reproduzir, em anúncios publicitários e textos de campanhas de conscientização destinados ao público infantil (orais e escritos, digitais ou impressos), a formatação e diagramação específica de cada um desses gêneros, inclusive o uso de imagens., EF12LP17 - Ler e compreender, em colaboração com os colegas e com a ajuda do professor, enunciados de tarefas escolares, diagramas, curiosidades, pequenos relatos de experimentos, entrevistas, verbetes de enciclopédia infantil, entre outros gêneros do campo investigativo, considerando a situação comunicativa e o tema/assunto do texto., EF02LP20 - Reconhecer a função de textos utilizados para apresentar informações coletadas em atividades de pesquisa (enquetes, pequenas entrevistas, registros de experimentações)., EF02LP21 - Explorar, com a mediação do professor, textos informativos de diferentes ambientes digitais de pesquisa, conhecendo suas possibilidades., EF01LP22 - Planejar e produzir, em colaboração com os colegas e com a ajuda do professor, diagramas, entrevistas, curiosidades, dentre outros gêneros do campo investigativo, digitais ou impressos, considerando a situação comunicativa e o tema/assunto/finalidade do texto., EF02LP22 - Planejar e produzir, em colaboração com os colegas e com a ajuda do professor, pequenos relatos de experimentos, entrevistas, verbetes de enciclopédia infantil, dentre outros gêneros do campo investigativo, digitais ou impressos, considerando a situação comunicativa e o tema/assunto/finalidade do texto., EF02LP23 - Planejar e produzir, com certa autonomia, pequenos registros de observação de resultados de pesquisa, coerentes com um tema investigado., EF01LP23 - Planejar e produzir, em colaboração com os colegas e com a ajuda do professor, entrevistas, curiosidades, dentre outros gêneros do campo investigativo, que possam ser repassados oralmente por meio de ferramentas digitais, em áudio ou vídeo, considerando a situação comunicativa e o tema/assunto/finalidade do texto., EF02LP24 - Planejar e produzir, em colaboração com os colegas e com a ajuda do professor, relatos de experimentos, registros de observação, entrevistas, dentre outros gêneros do campo investigativo, que possam ser repassados oralmente por meio de ferramentas digitais, em áudio ou vídeo, considerando a situação comunicativa e o tema/assunto/ finalidade do texto., EF01LP24 - Identificar e reproduzir, em enunciados de tarefas escolares, diagramas, entrevistas, curiosidades, digitais ou impressos, a formatação e diagramação específica de cada um desses gêneros, inclusive em suas versões orais., EF02LP25 - Identificar e reproduzir, em relatos de experimentos, entrevistas, verbetes de enciclopédia infantil, digitais ou impressos, a formatação e diagramação específica de cada um desses gêneros, inclusive em suas versões orais., EF02LP26 - Ler e compreender, com certa autonomia, textos literários, de gêneros variados, desenvolvendo o gosto pela leitura., EF12LP18 - Apreciar poemas e outros textos versificados, observando rimas, sonoridades, jogos de palavras, reconhecendo seu pertencimento ao mundo imaginário e sua dimensão de encantamento, jogo e fruição., EF01LP25 - Produzir, tendo o professor como escriba, recontagens de histórias lidas pelo professor, histórias imaginadas ou baseadas em livros de imagens, observando a forma de composição de textos narrativos (personagens, enredo, tempo e espaço)., EF02LP27 - Reescrever textos narrativos literários lidos pelo professor., EF01LP26 - Identificar elementos de uma narrativa lida ou escutada, incluindo personagens, enredo, tempo e espaço. EF02LP28 - Reconhecer o conflito gerador de uma narrativa ficcional e sua resolução, além de palavras, expressões e frases que caracterizam personagens e ambientes., EF12LP19 - Reconhecer, em textos versificados, rimas, sonoridades, jogos de palavras, palavras, expressões, comparações, relacionando-as com sensações e associações., EF02LP29 - Observar, em poemas visuais, o formato do texto na página, as ilustrações e outros efeitos visuais.";

// Continuar com o resto do texto... (o texto é muito longo, vou processar em partes)
// Por enquanto, vou criar uma função que processa o texto e gera o SQL

// Lista de códigos faltantes
$codigosFaltantes = [
    'EF02LP12', 'EF02LP13', 'EF02LP14', 'EF02LP15', 'EF02LP16', 'EF02LP17', 'EF12LP11', 'EF12LP12', 'EF01LP21', 'EF02LP18', 'EF02LP19', 'EF12LP13', 'EF12LP14', 'EF12LP15', 'EF12LP16', 'EF12LP17', 'EF02LP20', 'EF02LP21', 'EF01LP22', 'EF02LP22', 'EF02LP23', 'EF01LP23', 'EF02LP24', 'EF01LP24', 'EF02LP25', 'EF02LP26', 'EF12LP18', 'EF01LP25', 'EF02LP27', 'EF01LP26', 'EF02LP28', 'EF12LP19', 'EF02LP29'
];

// Mapeamento de componentes
$componentes = [
    'LP' => 'Língua Portuguesa',
    'AR' => 'Artes',
    'EF' => 'Educação Física',
    'MA' => 'Matemática',
    'CI' => 'Ciências',
    'GE' => 'Geografia',
    'HI' => 'História',
    'ER' => 'Ensino Religioso'
];

// Função para extrair descrição de um código
function extrairDescricao($codigo, $texto) {
    // Procurar o código no texto
    $pattern = '/' . preg_quote($codigo, '/') . '\s*-\s*([^,]+(?:\.,|$))/';
    
    if (preg_match($pattern, $texto, $matches)) {
        $descricao = trim($matches[1]);
        $descricao = rtrim($descricao, ',');
        return trim($descricao);
    }
    
    // Tentar busca mais flexível
    $posicao = strpos($texto, $codigo);
    if ($posicao !== false) {
        $parte = substr($texto, $posicao);
        // Encontrar próximo código
        if (preg_match('/EF\d{2}[A-Z]{2}\d{2}/', substr($parte, strlen($codigo) + 1), $nextMatch)) {
            $parte = substr($parte, 0, strpos($parte, $nextMatch[0]));
        }
        
        if (preg_match('/-\s*(.+?)(?:,\s*EF\d{2}[A-Z]{2}\d{2}|$)/s', $parte, $match)) {
            $descricao = trim($match[1]);
            $descricao = rtrim($descricao, ',');
            return trim($descricao);
        }
    }
    
    return null;
}

// Processar e gerar SQL
$sql = "-- Script SQL para inserir habilidades faltantes da BNCC\n";
$sql .= "-- Ensino Fundamental - Anos Iniciais\n";
$sql .= "-- Gerado em: " . date('d/m/Y H:i:s') . "\n\n";

$sql .= "START TRANSACTION;\n\n";

foreach ($codigosFaltantes as $codigo) {
    $descricao = extrairDescricao($codigo, $textoCompleto);
    
    if (preg_match('/EF(\d{2})([A-Z]{2})(\d{2})/', $codigo, $matches)) {
        $ano = (int)$matches[1];
        $componenteCodigo = $matches[2];
        $componenteNome = $componentes[$componenteCodigo] ?? $componenteCodigo;
        
        $anoInicio = $ano;
        $anoFim = $ano;
        
        if ($ano == 12) {
            $anoInicio = 1;
            $anoFim = 2;
        }
        
        if ($descricao) {
            $descricaoEscapada = addslashes($descricao);
            $sql .= "INSERT INTO habilidades_bncc (codigo_bncc, etapa, componente, ano_inicio, ano_fim, descricao) VALUES ";
            $sql .= "('$codigo', 'Ensino Fundamental – Anos Iniciais', '$componenteNome', $anoInicio, $anoFim, '$descricaoEscapada');\n";
        }
    }
}

$sql .= "\nCOMMIT;\n";

echo $sql;

